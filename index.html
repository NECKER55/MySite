<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andrea Veneroni - 3D Portfolio</title>
    <style>
        /* General Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: #ffffff;
            overflow-x: hidden;
            position: relative;
        }

        /* Canvas 3D as Fixed Background */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 1;
        }

        /* 2D Matrix Background Canvas */
        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 0;
            pointer-events: none;
        }

        /* Lighter Overlay to Not Obscure Animation */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
            z-index: 2;
            pointer-events: none;
        }

        /* Main Container Above 3D */
        .main-container {
            position: relative;
            z-index: 3;
            width: 100%;
            display: flex;
            min-height: 100vh;
            pointer-events: none;
        }

        /* Enable interaction only for clickable elements */
        .main-container * {
            pointer-events: auto;
        }

        /* Empty Space on the Left for the Model */
        .model-space {
            width: 45%;
            flex-shrink: 0;
            pointer-events: none;
        }

        /* Content Section on the Right with More Transparency */
        .content-section {
            flex: 1;
            padding: 80px 60px 80px 20px;
            background: linear-gradient(to right,
                rgba(0,0,0,0) 0%,
                rgba(0,0,0,0.2) 10%,
                rgba(0,0,0,0.4) 30%,
                rgba(0,0,0,0.5) 100%);
            backdrop-filter: blur(5px);
            min-height: 100vh;
        }

        /* Header */
        .header {
            margin-bottom: 80px;
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8), 2px 2px 10px rgba(0,0,0,0.8);
        }

        .subtitle {
            font-size: 1.3rem;
            color: #aaa;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.5), 1px 1px 5px rgba(0,0,0,0.8);
        }

        /* Sections */
        .section {
            margin-bottom: 70px;
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
        }

        .section:nth-child(2) { animation-delay: 0.2s; }
        .section:nth-child(3) { animation-delay: 0.4s; }
        .section:nth-child(4) { animation-delay: 0.6s; }
        .section:nth-child(5) { animation-delay: 0.8s; }

        .section-title {
            font-size: 2rem;
            margin-bottom: 25px;
            position: relative;
            padding-left: 15px;
            text-shadow: 0 0 15px rgba(138, 43, 226, 0.6), 1px 1px 5px rgba(0,0,0,0.8);
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 80%;
            background: linear-gradient(to bottom, #8A2BE2, #6A1EB0);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        /* Project Grid with More Transparency */
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        /* Project Button Styles */
        .project-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(138, 43, 226, 0.05);
            text-decoration: none;
            color: inherit;
        }

        .project-button:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(138, 43, 226, 0.05);
            border-color: rgba(138, 43, 226, 0.4);
            box-shadow: 0 15px 40px rgba(138, 43, 226, 0.3), inset 0 0 30px rgba(138, 43, 226, 0.1);
        }

        .project-button .icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: #8A2BE2;
            text-shadow: 0 0 30px rgba(138, 43, 226, 1);
            transition: transform 0.3s ease;
        }

        .project-button:hover .icon {
            transform: scale(1.15) rotate(5deg);
        }

        .project-button h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #8A2BE2;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8);
            text-align: center;
        }

        .project-button p {
            color: #ddd;
            line-height: 1.5;
            font-size: 0.95rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            text-align: center;
        }

        /* Timeline with More Transparency */
        .timeline {
            position: relative;
            padding-left: 35px;
            margin-top: 25px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 2px;
            background: linear-gradient(to bottom, #8A2BE2, transparent);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 35px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(8px);
            border-radius: 15px;
            border: 1px solid rgba(138, 43, 226, 0.15);
            transition: all 0.3s ease;
            box-shadow: inset 0 0 15px rgba(138, 43, 226, 0.03);
        }

        .timeline-item:hover {
            background: rgba(138, 43, 226, 0.03);
            border-color: rgba(138, 43, 226, 0.3);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -36px;
            top: 25px;
            width: 10px;
            height: 10px;
            background: #8A2BE2;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(138, 43, 226, 1);
        }

        .timeline-date {
            color: #8A2BE2;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.6);
        }

        .timeline-title {
            font-size: 1.2rem;
            margin-bottom: 8px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .timeline-description {
            color: #bbb;
            line-height: 1.5;
            font-size: 0.95rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Skills with More Transparency */
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .skill-item {
            background: rgba(138, 43, 226, 0.08);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(138, 43, 226, 0.25);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1), inset 0 0 15px rgba(138, 43, 226, 0.05);
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.4);
        }

        .skill-item:hover {
            background: rgba(138, 43, 226, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.3), inset 0 0 20px rgba(138, 43, 226, 0.1);
        }

        /* Contacts with More Transparency */
        .contact-info {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            color: #ddd;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            box-shadow: inset 0 0 10px rgba(138, 43, 226, 0.03);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .contact-item:hover {
            background: rgba(138, 43, 226, 0.08);
            border-color: rgba(138, 43, 226, 0.4);
            color: #8A2BE2;
            transform: translateY(-2px);
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.6);
        }

        /* Countdown Styles */
        .countdown-container {
            margin-top: 20px;
            padding: 15px;
            background: rgba(138, 43, 226, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            backdrop-filter: blur(10px);
        }

        .countdown-label {
            font-size: 0.9rem;
            color: #8A2BE2;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.8);
        }

        .countdown-display {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .countdown-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #8A2BE2;
            text-shadow: 0 0 20px rgba(138, 43, 226, 1);
            min-width: 40px;
            text-align: center;
            display: inline-block;
        }

        .countdown-unit {
            font-size: 0.8rem;
            color: #aaa;
            margin-right: 10px;
            text-shadow: 0 0 5px rgba(138, 43, 226, 0.5);
        }

        /* 3D Model Tooltip */
        .model-tooltip {
            position: fixed;
            background: rgba(138, 43, 226, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            color: #8A2BE2;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            pointer-events: none;
            opacity: 0;
            transform: translate(-50%, -150%) scale(0.8);
            transition: all 0.3s ease;
            z-index: 1;
            box-shadow: 0 5px 25px rgba(138, 43, 226, 0.3);
            text-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        .model-tooltip.visible {
            opacity: 1;
            transform: translate(-50%, -150%) scale(1);
            background: rgba(138, 43, 226, 0.2);
            border-color: rgba(138, 43, 226, 0.5);
            box-shadow: 0 8px 35px rgba(138, 43, 226, 0.5);
        }

        .model-tooltip::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(138, 43, 226, 0.3);
        }

        .model-tooltip.visible::after {
            border-top-color: rgba(138, 43, 226, 0.5);
        }

        @keyframes float {
            0%, 100% {
                transform: translateX(-50%) translateY(0px);
            }
            50% {
                transform: translateX(-50%) translateY(-10px);
            }
        }

        /* Loading and Error */
        #loading {
            position: fixed;
            top: 50%;
            left: 22.5%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 10;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8), 2px 2px 10px rgba(0,0,0,0.8);
        }

        #error {
            position: fixed;
            top: 50%;
            left: 22.5%;
            transform: translate(-50%, -50%);
            color: #ff0000;
            font-size: 16px;
            text-align: center;
            max-width: 300px;
            display: none;
            z-index: 10;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Course Tree Section */
        .course-tree-section {
            position: relative;
            z-index: 3;
            background: linear-gradient(to bottom,
                rgba(0,0,0,0.2) 0%,
                rgba(0,0,0,0.8) 100%);
            backdrop-filter: blur(8px);
            padding: 80px 60px;
            margin-top: 50px;
            border-top: 1px solid rgba(138, 43, 226, 0.2);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }

        .course-tree-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .course-tree-title {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 60px;
            color: #8A2BE2;
            text-shadow: 0 0 25px rgba(138, 43, 226, 0.8), 2px 2px 10px rgba(0,0,0,0.8);
            position: relative;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s ease-out, transform 1s ease-out;
            transition-delay: 0.2s;
        }

        .course-tree-title.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .course-tree-container {
            position: relative;
            width: 100%;
            min-height: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .year-label {
            position: absolute;
            left: 20px; /* Position to the left of the nodes */
            font-size: 1.5rem;
            font-weight: bold;
            color: #aaa;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.5); /* Purple shadow */
            transform: translateX(-100%); /* Start off-screen */
            opacity: 0;
            transition: all 0.8s ease-out;
        }

        .year-label.visible {
            transform: translateX(0);
            opacity: 1;
        }

        /* Specific delays for year labels */
        .year-label:nth-child(1) { transition-delay: 0.3s; }
        .year-label:nth-child(2) { transition-delay: 0.5s; }
        .year-label:nth-child(3) { transition-delay: 0.7s; }
        .year-label:nth-child(4) { transition-delay: 0.9s; } /* Delay for new label */

        .course-node {
            position: absolute;
            width: 180px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border-radius: 15px;
            border: 1px solid rgba(138, 43, 226, 0.25);
            text-align: center;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(138, 43, 226, 0.08);
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out, background 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        .course-node.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .course-node:hover {
            transform: scale(1.05) translateY(-5px);
            background: rgba(138, 43, 226, 0.08);
            border-color: rgba(138, 43, 226, 0.5);
            box-shadow: 0 10px 35px rgba(138, 43, 226, 0.4), inset 0 0 25px rgba(138, 43, 226, 0.15);
        }

        .course-icon {
            font-size: 2.2rem;
            margin-bottom: 8px;
            display: block;
            color: #8A2BE2;
            text-shadow: 0 0 25px rgba(138, 43, 226, 1);
        }

        .course-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #e0e0e0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .course-credits {
            font-size: 0.85rem;
            color: #bbb;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .course-status {
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 8px;
        }

        /* Status colors for nodes */
        .course-node.completed {
            border-color: rgba(90, 200, 90, 0.4);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(90, 200, 90, 0.05);
        }
        .course-node.completed .course-status {
            color: #5ac85a;
            text-shadow: 0 0 10px rgba(90, 200, 90, 0.8);
        }
        .course-node.completed:hover {
            border-color: rgba(90, 200, 90, 0.6);
            box-shadow: 0 10px 35px rgba(90, 200, 90, 0.3), inset 0 0 25px rgba(90, 200, 90, 0.1);
        }

        .course-node.in-progress {
            border-color: rgba(255, 200, 50, 0.4);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(255, 200, 50, 0.05);
        }
        .course-node.in-progress .course-status {
            color: #ffc832;
            text-shadow: 0 0 10px rgba(255, 200, 50, 0.8);
        }
        .course-node.in-progress:hover {
            border-color: rgba(255, 200, 50, 0.6);
            box-shadow: 0 10px 35px rgba(255, 200, 50, 0.3), inset 0 0 25px rgba(255, 200, 50, 0.1);
        }

        .course-node.not-started {
            border-color: rgba(200, 200, 200, 0.2);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(200, 200, 200, 0.05);
        }
        .course-node.not-started .course-status {
            color: #bbbbbb;
            text-shadow: 0 0 10px rgba(200, 200, 200, 0.8);
        }
        .course-node.not-started:hover {
            border-color: rgba(200, 200, 200, 0.4);
            box-shadow: 0 10px 35px rgba(200, 200, 200, 0.3), inset 0 0 25px rgba(200, 200, 200, 0.1);
        }

        /* SVG Connections */
        .tree-connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .connection-path {
            fill: none;
            stroke: rgba(138, 43, 226, 0.3);
            stroke-width: 2;
            transition: stroke 0.3s ease, stroke-width 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        .connection-path.visible {
            opacity: 1;
            stroke-dashoffset: 0;
        }

        /* Mobile Navigation Button */
        .mobile-nav-button {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(138, 43, 226, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.4);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mobile-nav-button:hover {
            background: rgba(138, 43, 226, 0.3);
            transform: scale(1.1);
        }

        .mobile-nav-button span {
            display: block;
            width: 25px;
            height: 3px;
            background: #8A2BE2;
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            right: -100%;
            width: 80%;
            max-width: 350px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 999;
            padding: 80px 30px 30px;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .mobile-menu.active {
            right: 0;
        }

        .mobile-menu-item {
            display: block;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .mobile-menu-item:hover {
            background: rgba(138, 43, 226, 0.2);
            transform: translateX(-5px);
        }

        /* Nascondi/mostra elementi basati sul dispositivo */
        .desktop-only {
            display: block;
        }

        .mobile-only {
            display: none;
        }

        @media (max-width: 768px) {
            .desktop-only {
                display: none;
            }
            
            .mobile-only {
                display: block;
            }
            
            .course-tree-container {
                display: none; /* Nascondi la versione desktop su mobile */
            }
        }

        /* Stili per l'accordion mobile */
        .course-accordion {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .accordion-item {
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .accordion-header {
            width: 100%;
            padding: 20px;
            background: rgba(138, 43, 226, 0.05);
            border: none;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .accordion-header:hover {
            background: rgba(138, 43, 226, 0.1);
        }

        .accordion-icon {
            transition: transform 0.3s ease;
            color: #8A2BE2;
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0;
        }

        .accordion-item.active .accordion-content {
            max-height: 1000px;
            padding: 20px;
        }

        /* Stili per i corsi nell'accordion */
        .mobile-course-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(138, 43, 226, 0.15);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .mobile-course-item:last-child {
            margin-bottom: 0;
        }

        .mobile-course-item:hover {
            background: rgba(138, 43, 226, 0.08);
            border-color: rgba(138, 43, 226, 0.3);
            transform: translateX(5px);
        }

        .mobile-course-icon {
            font-size: 2rem;
            margin-right: 15px;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8);
        }

        .mobile-course-info {
            flex: 1;
        }

        .mobile-course-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 5px;
        }

        .mobile-course-credits {
            font-size: 0.9rem;
            color: #aaa;
        }

        .mobile-course-status {
            font-size: 0.85rem;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
        }

        /* Status colors per accordion */
        .mobile-course-item.completed .mobile-course-status {
            color: #5ac85a;
            background: rgba(90, 200, 90, 0.1);
        }

        .mobile-course-item.in-progress .mobile-course-status {
            color: #ffc832;
            background: rgba(255, 200, 50, 0.1);
        }

        .mobile-course-item.not-started .mobile-course-status {
            color: #bbbbbb;
            background: rgba(200, 200, 200, 0.1);
        }

        /* Responsive Styles */
        @media (max-width: 1024px) {
            .model-space {
                width: 100%;
                height: 40vh;
                position: relative;
            }

            .main-container {
                flex-direction: column;
            }

            .content-section {
                padding: 40px 30px;
                background: linear-gradient(to bottom,
                    rgba(0,0,0,0.2) 0%,
                    rgba(0,0,0,0.6) 20%);
            }

            h1 {
                font-size: 2.5rem;
            }

            #loading, #error {
                left: 50%;
            }

            .mobile-nav-button {
                display: flex;
                flex-direction: column;
            }

            .mobile-menu {
                display: block;
            }

            .project-grid {
                grid-template-columns: 1fr;
            }

            .skills-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .course-tree-section {
                padding: 40px 20px;
            }

            .course-tree-container {
                min-height: 1100px;
            }

            .year-label {
                font-size: 1.2rem;
            }

            .course-node {
                width: 150px;
                padding: 12px;
            }

            .course-icon {
                font-size: 1.8rem;
            }

            .course-name {
                font-size: 1rem;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1.1rem;
            }

            .section-title {
                font-size: 1.6rem;
            }

            .project-button {
                padding: 20px;
            }

            .project-button .icon {
                font-size: 2.5rem;
            }

            .project-button h3 {
                font-size: 1.2rem;
            }

            .timeline {
                padding-left: 25px;
            }

            .skills-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

        

            .contact-info {
                flex-direction: column;
                gap: 15px;
            }

            .contact-item {
                width: 100%;
                justify-content: center;
            }

            .countdown-display {
                justify-content: center;
            }

            .countdown-number {
                font-size: 1.5rem;
            }

            .course-tree-title {
                font-size: 2rem;
                margin-bottom: 40px;
            }

            .course-tree-container {
                min-height: 1200px;
                padding: 10px;
            }

            .course-node {
                width: 140px;
                font-size: 0.9rem;
                padding: 10px;
            }

            .course-icon {
                font-size: 1.8rem;
            }

            .course-name {
                font-size: 1rem;
            }

            .course-credits, .course-status {
                font-size: 0.8rem;
            }

            .year-label {
                left: 10px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .content-section {
                padding: 30px 20px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .section-title {
                font-size: 1.4rem;
                padding-left: 10px;
            }

            .project-button {
                padding: 15px;
            }

            .project-button .icon {
                font-size: 2rem;
            }

            .project-button h3 {
                font-size: 1.1rem;
            }

            .project-button p {
                font-size: 0.85rem;
            }

            .timeline-item {
                padding: 15px;
            }

            .timeline-title {
                font-size: 1.1rem;
            }

            .timeline-description {
                font-size: 0.85rem;
            }

            .skill-item {
                padding: 10px;
                font-size: 0.85rem;
            }

            .countdown-container {
                padding: 10px;
            }

            .countdown-number {
                font-size: 1.3rem;
                min-width: 30px;
            }

            .countdown-unit {
                font-size: 0.7rem;
            }

            .course-tree-section {
                padding: 30px 15px;
            }

            .course-tree-title {
                font-size: 1.8rem;
                margin-bottom: 30px;
            }

            .course-tree-container {
                min-height: 1400px;
            }

            .course-node {
                width: 120px;
                padding: 8px;
            }

            .course-icon {
                font-size: 1.5rem;
            }

            .course-name {
                font-size: 0.9rem;
            }

            .year-label {
                font-size: 1rem;
                left: 5px;
            }

            /* Adjust model tooltip for mobile */
            .model-tooltip {
                font-size: 0.9rem;
                padding: 10px 20px;
            }

            /* Mobile-specific 3D adjustments */
            #canvas-container {
                height: 40vh;
            }

            #loading {
                font-size: 16px;
            }
        }

        /* Landscape mobile adjustments */
        @media (max-width: 768px) and (orientation: landscape) {
            .model-space {
                height: 60vh;
            }

            .content-section {
                padding: 30px 40px;
            }

            .project-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .skills-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .contact-info {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .course-tree-container {
                min-height: 800px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .project-button:hover {
                transform: none;
            }

            .skill-item:hover {
                transform: none;
            }

            .contact-item:hover {
                transform: none;
            }

            .course-node:hover {
                transform: scale(1.02);
            }

            /* Disable hover effects on touch devices */
            .timeline-item:hover {
                background: rgba(255, 255, 255, 0.01);
                border-color: rgba(138, 43, 226, 0.15);
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }

            .connection-path {
                stroke-dasharray: none !important;
                stroke-dashoffset: 0 !important;
                opacity: 1 !important;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            body {
                background-color: #000;
            }

            .project-button,
            .timeline-item,
            .skill-item,
            .contact-item {
                border-width: 2px;
            }

            h1, .section-title {
                text-shadow: none;
            }
        }

        /* Print styles */
        @media print {
            #canvas-container,
            #matrix-canvas,
            .overlay,
            .mobile-nav-button,
            .mobile-menu {
                display: none !important;
            }

            .main-container {
                display: block;
            }

            .model-space {
                display: none;
            }

            .content-section {
                background: none;
                padding: 20px;
            }

            body {
                background: white;
                color: black;
            }

            .project-button,
            .timeline-item,
            .skill-item {
                border-color: #333;
                box-shadow: none;
            }
        }

        /* Aggiungi questa nuova regola CSS */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                padding-top: 50vh; /* Aggiunge spazio vuoto sopra */
            }

            .model-space {
                width: 100%;
                height: 40vh;
                position: fixed; /* Cambia da relative a fixed */
                top: 0;
                left: 0;
                z-index: 1;
            }

            .content-section {
                position: relative;
                z-index: 3;
                padding: 40px 30px;
                background: linear-gradient(to bottom,
                    rgba(0,0,0,0.2) 0%,
                    rgba(0,0,0,0.6) 20%);
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding-top: 0vh; /* Regola questo valore per pi√π o meno spazio */
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding-top: 0vh; /* Regola per schermi molto piccoli */
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div class="overlay"></div>
    <canvas id="matrix-canvas"></canvas>

    <div id="loading">Loading 3D Model...</div>
    <div id="error"></div>

    <div class="model-tooltip" id="model-tooltip">Robotics Projects</div>

    <!-- Mobile Navigation Button -->
    <div class="mobile-nav-button" id="mobile-nav-button">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" id="mobile-menu">
        <a href="#projects" class="mobile-menu-item">My Projects</a>
        <a href="#university" class="mobile-menu-item">University Path</a>
        <a href="#skills" class="mobile-menu-item">Skills</a>
        <a href="#contact" class="mobile-menu-item">Contact</a>
        <a href="#academic" class="mobile-menu-item">Academic Journey</a>
        <a href="robotic_projects.html" class="mobile-menu-item">ü§ñ Robotics Projects</a>
    </nav>

    <div class="main-container">
        <div class="model-space"></div>

        <div class="content-section">
            <div class="header">
                <h1>Andrea Veneroni</h1>
                <p class="subtitle">Student</p>
            </div>

            <div class="section" id="projects">
                <h2 class="section-title">My Projects</h2>
                <div class="project-grid">
                    <a href="fisica.html" class="project-button">
                        <span class="icon">ü™ê</span>
                        <h3>Physics Simulations</h3>
                        <p>Explore a highly accurate solar system simulation and asteroid launch mechanics, demonstrating advanced physics modeling.</p>
                    </a>
                    <a href="terminal.html" class="project-button">
                        <span class="icon">üó∫Ô∏è</span>
                        <h3>Minecraft Map Generator</h3>
                        <p>A custom 3D Minecraft-style map generator, implemented from scratch using the Perlin noise algorithm.</p>
                    </a>
                    <a href="uni_projects.html" class="project-button">
                        <span class="icon">üéì</span>
                        <h3>University Projects</h3>
                        <p>A collection of academic projects, showcasing my skills in software engineering, data analysis, and algorithm design.</p>
                    </a>
                </div>
            </div>

            <div class="section" id="university">
                <h2 class="section-title">University Path</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">2023 - 2026</div>
                        <div class="timeline-title">Bachelor's Degree in Computer Science</div>
                        <div class="timeline-description">
                            University of Milan - Focused on software robotics and A.I.
                        </div>
                        <div class="countdown-container">
                            <div class="countdown-label">Time to Graduation:</div>
                            <div id="graduation-countdown" class="countdown-display">
                                <span class="countdown-number" id="days">--</span>
                                <span class="countdown-unit">days</span>
                                <span class="countdown-number" id="hours">--</span>
                                <span class="countdown-unit">hours</span>
                                <span class="countdown-number" id="minutes">--</span>
                                <span class="countdown-unit">minutes</span>
                                <span class="countdown-number" id="seconds">--</span>
                                <span class="countdown-unit">seconds</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="skills">
                <h2 class="section-title">Skills</h2>
                <div class="skills-grid">
                    <div class="skill-item">C++</div>
                    <div class="skill-item">Go</div>
                    <div class="skill-item">Python</div>
                    <div class="skill-item">Machine Learning</div>
                    <div class="skill-item">Game Development</div>
                    <div class="skill-item">ROS2</div>
                </div>
            </div>

            <div class="section" id="contact">
                <h2 class="section-title">Contact</h2>
                <div class="contact-info">
                    <a href="mailto:aven00004@gmail.com" class="contact-item">
                        <span>üìß</span> aven00004@gmail.com
                    </a>
                    <a href="https://github.com/NECKER55" class="contact-item">
                        <span>üêô</span> GitHub
                    </a>
                    <a href="https://www.instagram.com/andreaveneronii" class="contact-item">
                        <span>üì±</span> Instagram
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="course-tree-section" id="academic">
        <h2 class="course-tree-title">Academic Journey</h2>
        
        <!-- Versione Desktop (rimane uguale) -->
        <div class="course-tree-container desktop-only">
            <svg class="tree-connections" id="tree-svg"></svg>
            <div class="year-label" style="top: 110px;">Year 1</div>
            <div class="year-label" style="top: 330px;">Year 2</div>
            <div class="year-label" style="top: 550px;">Year 3</div>
            <div class="year-label" style="top: 790px;">Extra Courses</div>
        </div>
        
        <!-- Versione Mobile (menu a tendina) -->
        <div class="course-accordion mobile-only">
            <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion('year1')">
                    <span>Year 1</span>
                    <span class="accordion-icon">‚ñº</span>
                </button>
                <div class="accordion-content" id="year1-content"></div>
            </div>
            
            <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion('year2')">
                    <span>Year 2</span>
                    <span class="accordion-icon">‚ñº</span>
                </button>
                <div class="accordion-content" id="year2-content"></div>
            </div>
            
            <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion('year3')">
                    <span>Year 3</span>
                    <span class="accordion-icon">‚ñº</span>
                </button>
                <div class="accordion-content" id="year3-content"></div>
            </div>
            
            <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion('extra')">
                    <span>Extra Courses</span>
                    <span class="accordion-icon">‚ñº</span>
                </button>
                <div class="accordion-content" id="extra-content"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.7.0/umd/index.min.js"></script>

    <script>
        // Three.js Global Variables
        let scene, camera, renderer;
        let model, mixer, clock;
        const container = document.getElementById('canvas-container');
        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error');

        // Matrix 2D Effect Global Variables
        const matrixCanvas = document.getElementById('matrix-canvas');
        const matrixCtx = matrixCanvas.getContext('2d');
        let matrixDrops = [];
        const fontSize = 16;
        const characters = '01';
        let columns;
        let tooltip;

        let raycaster, mouse;
        let isHovering = false;

        // Mobile menu functionality
        const mobileNavButton = document.getElementById('mobile-nav-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileNavButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
            mobileNavButton.classList.toggle('active');
        });

        // Close mobile menu when clicking a link
        document.querySelectorAll('.mobile-menu-item').forEach(item => {
            item.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                mobileNavButton.classList.remove('active');
            });
        });

        // Add mouse event listeners
        container.addEventListener('mousemove', onMouseMove, false);
        container.addEventListener('click', onMouseClick, false);

        // Touch events for mobile
        container.addEventListener('touchstart', onTouchStart, false);
        container.addEventListener('touchend', onTouchEnd, false);

        // Course Data Structure
        const courseData = {
            year1: [
                { id: 'prog1', name: 'Programming I', credits: 12, icon: 'üíª', status: 'completed' },
                { id: 'math1', name: 'Continuum Mathematics', credits: 12, icon: 'üìê', status: 'completed' },
                { id: 'arch1', name: 'Computer Architecture I', credits: 6, icon: 'üñ•Ô∏è', status: 'completed' },
                { id: 'logic', name: 'Mathematical Logic', credits: 6, icon: 'üßÆ', status: 'completed' },
                { id: 'arch2', name: 'Computer Architecture II', credits: 6, icon: 'üñ•Ô∏è', status: 'completed' },
                { id: 'lfa', name: 'Formal Languages and Automata', credits: 6, icon: '0Ô∏è‚É£1Ô∏è‚É£', status: 'completed' },
                { id: 'discrete', name: 'Discrete Mathematics', credits: 6, icon: 'üî¢', status: 'completed' }
            ],
            year2: [
                { id: 'prog2', name: 'Programming II', credits: 6, icon: 'üöÄ', status: 'completed'},
                { id: 'algo', name: 'Algorithms & Data Structures', credits: 12, icon: 'üå≥', status: 'completed'},
                { id: 'ai', name: 'Artificial Intelligence', credits: 6, icon: 'ü§ñ', status: 'completed'},
                { id: 'os', name: 'Operating Systems', credits: 12, icon: '‚öôÔ∏è', status: 'completed'},
                { id: 'stats', name: 'Statistics', credits: 6, icon: 'üìä', status: 'completed'},
                { id: 'db', name: 'Databases', credits: 12, icon: 'üóÑÔ∏è', status: 'in-progress'}
            ],
            year3: [
                { id: 'biometric', name: 'Biometric Systems', credits: 6, icon: 'üîí', status: 'completed'},
                { id: 'vis', name: 'Scientific Visualization', credits: 6, icon: 'üìà', status: 'completed'},
                { id: 'physics', name: 'Physics', credits: 6, icon: 'ü™ê', status: 'completed'},
                { id: 'info', name: 'Information Theory', credits: 6, icon: 'üì°', status: 'not-started'},
                { id: 'net', name: 'Computer Networks', credits: 12, icon: 'üåê', status: 'in-progress'},
                { id: 'sweng', name: 'Software Engineering', credits: 12, icon: 'üõ†Ô∏è', status: 'not-started'}
            ],
            year4: [
                { id: 'deep', name: 'Deep Learning', credits: 6, icon: 'üß†', status: 'completed'},
                { id: 'game_dev', name: '3D Game Development', credits: 6, icon: 'üéÆ', status: 'completed'}
            ]
        };

            
                // Funzione per toggle accordion
        function toggleAccordion(yearId) {
            const item = document.querySelector(`#${yearId}-content`).parentElement;
            const allItems = document.querySelectorAll('.accordion-item');
            
            // Chiudi tutti gli altri
            allItems.forEach(otherItem => {
                if (otherItem !== item) {
                    otherItem.classList.remove('active');
                }
            });
            
            // Toggle l'item corrente
            item.classList.toggle('active');
        }

        // Funzione per creare i corsi mobile
        function createMobileCourses() {
            // Popola Year 1
            const year1Content = document.getElementById('year1-content');
            if (year1Content) {
                year1Content.innerHTML = courseData.year1.map(course => `
                    <div class="mobile-course-item ${course.status}">
                        <span class="mobile-course-icon">${course.icon}</span>
                        <div class="mobile-course-info">
                            <div class="mobile-course-name">${course.name}</div>
                            <div class="mobile-course-credits">${course.credits} CFU</div>
                        </div>
                        <span class="mobile-course-status">${getStatusText(course.status)}</span>
                    </div>
                `).join('');
            }
            
            // Popola Year 2
            const year2Content = document.getElementById('year2-content');
            if (year2Content) {
                year2Content.innerHTML = courseData.year2.map(course => `
                    <div class="mobile-course-item ${course.status}">
                        <span class="mobile-course-icon">${course.icon}</span>
                        <div class="mobile-course-info">
                            <div class="mobile-course-name">${course.name}</div>
                            <div class="mobile-course-credits">${course.credits} CFU</div>
                        </div>
                        <span class="mobile-course-status">${getStatusText(course.status)}</span>
                    </div>
                `).join('');
            }
            
            // Popola Year 3
            const year3Content = document.getElementById('year3-content');
            if (year3Content) {
                year3Content.innerHTML = courseData.year3.map(course => `
                    <div class="mobile-course-item ${course.status}">
                        <span class="mobile-course-icon">${course.icon}</span>
                        <div class="mobile-course-info">
                            <div class="mobile-course-name">${course.name}</div>
                            <div class="mobile-course-credits">${course.credits} CFU</div>
                        </div>
                        <span class="mobile-course-status">${getStatusText(course.status)}</span>
                    </div>
                `).join('');
            }
            
            // Popola Extra Courses
            const extraContent = document.getElementById('extra-content');
            if (extraContent) {
                extraContent.innerHTML = courseData.year4.map(course => `
                    <div class="mobile-course-item ${course.status}">
                        <span class="mobile-course-icon">${course.icon}</span>
                        <div class="mobile-course-info">
                            <div class="mobile-course-name">${course.name}</div>
                            <div class="mobile-course-credits">${course.credits} CFU</div>
                        </div>
                        <span class="mobile-course-status">${getStatusText(course.status)}</span>
                    </div>
                `).join('');
            }
        }

        // Helper function per il testo dello status
        function getStatusText(status) {
            switch(status) {
                case 'completed': return 'Completed';
                case 'in-progress': return 'In Progress';
                case 'not-started': return 'Not Started';
                default: return '';
            }
        }

        // Aggiungi questa chiamata nella funzione init()
        // Trova questa parte nel codice esistente:
        setTimeout(() => {
            createCourseNodes();
            drawConnections();
            setupScrollAnimations();
            createMobileCourses(); // AGGIUNGI QUESTA LINEA
        }, 100);

        // Function to calculate node positions
        function calculateNodePositions() {
            const containerWidth = document.querySelector('.course-tree-container').offsetWidth;
            const isMobile = window.innerWidth <= 768;
            const nodePositions = {};

            // Adjust spacing for mobile
            const nodeWidth = isMobile ? 120 : 180;
            const horizontalPadding = isMobile ? 10 : 20;
            const verticalOffset = 50;

            // Year 1 positions
            const year1Spacing = (containerWidth - horizontalPadding * 2) / courseData.year1.length;
            courseData.year1.forEach((course, index) => {
                nodePositions[course.id] = {
                    x: horizontalPadding + (year1Spacing * index) + (year1Spacing - nodeWidth) / 2,
                    y: 100 + verticalOffset
                };
            });

            // Year 2 positions
            const year2Spacing = (containerWidth - horizontalPadding * 2) / courseData.year2.length;
            courseData.year2.forEach((course, index) => {
                nodePositions[course.id] = {
                    x: horizontalPadding + (year2Spacing * index) + (year2Spacing - nodeWidth) / 2,
                    y: 320 + verticalOffset
                };
            });

            // Year 3 positions
            const year3Spacing = (containerWidth - horizontalPadding * 2) / courseData.year3.length;
            courseData.year3.forEach((course, index) => {
                nodePositions[course.id] = {
                    x: horizontalPadding + (year3Spacing * index) + (year3Spacing - nodeWidth) / 2,
                    y: 540 + verticalOffset
                };
            });

            // Year 4 / Extra Courses positions
            const year4Spacing = (containerWidth - horizontalPadding * 2) / courseData.year4.length;
            courseData.year4.forEach((course, index) => {
                nodePositions[course.id] = {
                    x: horizontalPadding + (year4Spacing * index) + (year4Spacing - nodeWidth) / 2,
                    y: 810 + verticalOffset
                };
            });

            return nodePositions;
        }

        // Create course nodes
        function createCourseNodes() {
            const container = document.querySelector('.course-tree-container');
            const positions = calculateNodePositions();

            // Create all nodes
            [...courseData.year1, ...courseData.year2, ...courseData.year3, ...courseData.year4].forEach((course, index) => {
                const node = document.createElement('div');
                node.className = `course-node ${course.status}`;
                node.id = `node-${course.id}`;
                node.style.left = `${positions[course.id].x}px`;
                node.style.top = `${positions[course.id].y}px`;
                node.style.animationDelay = `${index * 0.1}s`;

                let statusText;
                if (course.status === 'completed') {
                    statusText = 'Completed';
                } else if (course.status === 'in-progress') {
                    statusText = 'In Progress';
                } else {
                    statusText = 'Not Started';
                }

                node.innerHTML = `
                    <span class="course-icon">${course.icon}</span>
                    <div class="course-name">${course.name}</div>
                    <div class="course-credits">${course.credits} CFU</div>
                    <div class="course-status">${statusText}</div>
                `;

                container.appendChild(node);

                // Add hover effect with details
                node.addEventListener('mouseenter', function() {
                    if (course.requires) {
                        highlightDependencies(course.id);
                    }
                });

                node.addEventListener('mouseleave', function() {
                    clearHighlights();
                });

                // Touch events for mobile
                node.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    if (course.requires) {
                        highlightDependencies(course.id);
                    }
                });

                node.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    setTimeout(clearHighlights, 1000);
                });
            });
        }

        // Draw connections between nodes
        function drawConnections() {
            const svg = document.getElementById('tree-svg');
            const positions = calculateNodePositions();
            const isMobile = window.innerWidth <= 768;
            const nodeWidth = isMobile ? 120 : 180;
            const nodeHeight = isMobile ? 80 : 100;

            // Define connections
            const connections = [
                // Year 1 to Year 2
                { from: 'prog1', to: 'prog2' },
                { from: 'prog1', to: 'algo' },
                { from: 'math1', to: 'stats' },
                { from: 'arch1', to: 'os' },
                { from: 'arch2', to: 'os' },
                { from: 'lfa', to: 'ai' },
                { from: 'discrete', to: 'algo' },
                
                // Year 2 to Year 3
                { from: 'prog2', to: 'sweng' },
                { from: 'algo', to: 'net' },
                { from: 'ai', to: 'biometric' },
                { from: 'stats', to: 'info' },
                { from: 'db', to: 'vis' },
                
                // Year 2/3 to Year 4
                { from: 'ai', to: 'deep' },
                { from: 'prog2', to: 'game_dev' },
                { from: 'vis', to: 'game_dev' }
            ];

            connections.forEach(conn => {
                const from = positions[conn.from];
                const to = positions[conn.to];

                if (from && to) {
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midY = (from.y + to.y) / 2;
                    
                    const d = `M ${from.x + nodeWidth/2} ${from.y + nodeHeight}
                              C ${from.x + nodeWidth/2} ${midY},
                                ${to.x + nodeWidth/2} ${midY},
                                ${to.x + nodeWidth/2} ${to.y}`;

                    path.setAttribute('d', d);
                    path.setAttribute('class', 'connection-path');
                    path.setAttribute('id', `path-${conn.from}-${conn.to}`);
                    svg.appendChild(path);
                }
            });
        }

        // Highlight dependencies on hover
        function highlightDependencies(courseId) {
            const paths = document.querySelectorAll('.connection-path');
            paths.forEach(path => {
                if (path.id.includes(courseId)) {
                    path.style.stroke = '#8A2BE2';
                    path.style.strokeWidth = '3';
                    path.style.opacity = '1';
                }
            });
        }

        // Clear highlights
        function clearHighlights() {
            const paths = document.querySelectorAll('.connection-path');
            paths.forEach(path => {
                path.style.stroke = '';
                path.style.strokeWidth = '';
                path.style.opacity = '';
            });
        }

        // Intersection Observer for scroll animations
        function setupScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -100px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            // Observe elements
            const elementsToObserve = [
                '.course-tree-section',
                '.course-tree-title',
                '.year-label',
                '.course-node',
                '.connection-path'
            ];

            elementsToObserve.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    observer.observe(el);
                });
            });
        }

        // Initialization
        function init() {
            // Initialize 2D Matrix Effect Canvas
            initMatrixRain();

            // Create Three.js scene
            scene = new THREE.Scene();

            // Create perspective camera
            const aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(50, aspect, 0.1, 1000);
            
            // Adjust camera position for mobile
            if (window.innerWidth <= 768) {
                camera.position.set(-5, 2, 15);
                camera.lookAt(-2, -1, 0);
            } else {
                camera.position.set(-8, 2, 12);
                camera.lookAt(-3, -2, 0);
            }

            // Create renderer
            renderer = new THREE.WebGLRenderer({
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Limit pixel ratio for performance
            container.appendChild(renderer.domElement);

            // Initialize raycaster and mouse
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Get tooltip element
            tooltip = document.getElementById('model-tooltip');

            // Add lights
            setupLights();

            // Clock for animations
            clock = new THREE.Clock();

            // Load GLB model
            loadGLBModel();

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);

            // Call functions to create and draw course tree elements
            setTimeout(() => {
                createCourseNodes();
                drawConnections();
                setupScrollAnimations();
            }, 100);
        }

        // Initialize 2D Matrix Effect
        function initMatrixRain() {
            matrixCanvas.width = window.innerWidth;
            matrixCanvas.height = window.innerHeight;

            columns = Math.floor(matrixCanvas.width / fontSize);
            matrixDrops = [];

            for (let i = 0; i < columns; i++) {
                matrixDrops[i] = Math.floor(Math.random() * -100);
            }
        }

        // Configure Lights
        function setupLights() {
            const ambientLight = new THREE.AmbientLight(0x404040, 1.5);
            scene.add(ambientLight);

            const mainLight = new THREE.DirectionalLight(0xffffff, 3.8);
            mainLight.position.set(0, 5, 0);
            scene.add(mainLight);

            const rimLight = new THREE.DirectionalLight(0x8A2BE2, 1.5);
            rimLight.position.set(0, 2, 5);
            scene.add(rimLight);

            const pointLight = new THREE.PointLight(0xffffff, 0.3, 20);
            pointLight.position.set(-5, 0, 5);
            scene.add(pointLight);
        }

        // Load GLB Model
        function loadGLBModel() {
            const loader = new THREE.GLTFLoader();

            loader.load(
                'robot_static.glb',
                function (gltf) {
                    model = gltf.scene;

                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());

                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = window.innerWidth <= 768 ? 15 / maxDim : 23 / maxDim;
                    model.scale.setScalar(scale);

                    // Adjust position for mobile
                    if (window.innerWidth <= 768) {
                        model.position.x = -center.x * scale;
                        model.position.y = -center.y * scale - 5;
                        model.position.z = -center.z * scale - 5;
                    } else {
                        model.position.x = -center.x * scale - 9;
                        model.position.y = -center.y * scale - 9;
                        model.position.z = -center.z * scale - 10;
                    }

                    model.rotation.y = 0;

                    scene.add(model);

                    if (gltf.animations && gltf.animations.length > 0) {
                        mixer = new THREE.AnimationMixer(model);
                        const action = mixer.clipAction(gltf.animations[0]);
                        action.play();
                    }

                    loadingElement.style.display = 'none';
                    animate();
                },
                function (xhr) {
                    const percentComplete = (xhr.loaded / xhr.total) * 100;
                    loadingElement.textContent = `Loading: ${Math.round(percentComplete)}%`;
                },
                function (error) {
                    console.error('Error loading GLB:', error);
                    loadingElement.style.display = 'none';
                    errorElement.style.display = 'block';
                    errorElement.innerHTML = `
                        Error loading 3D model.<br>
                        Please ensure 'robot_static.glb' is in the same folder as the HTML file.
                    `;
                }
            );
        }

        // Handle Window Resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);

            // Update camera position for mobile
            if (window.innerWidth <= 768) {
                camera.position.set(-5, 2, 15);
                camera.lookAt(-2, -1, 0);
            } else {
                camera.position.set(-8, 2, 12);
                camera.lookAt(-3, -2, 0);
            }

            // Update 2D canvas
            matrixCanvas.width = window.innerWidth;
            matrixCanvas.height = window.innerHeight;
            columns = Math.floor(matrixCanvas.width / fontSize);
            matrixDrops = [];
            for (let i = 0; i < columns; i++) {
                matrixDrops[i] = Math.floor(Math.random() * -100);
            }

            // Recalculate and redraw node positions and connections on resize
            const positions = calculateNodePositions();

            // Update node positions for all years
            [...courseData.year1, ...courseData.year2, ...courseData.year3, ...courseData.year4].forEach(course => {
                const node = document.getElementById(`node-${course.id}`);
                if (node && positions[course.id]) {
                    node.style.left = `${positions[course.id].x}px`;
                    node.style.top = `${positions[course.id].y}px`;
                }
            });

            // Clear and redraw connections
            const svg = document.getElementById('tree-svg');
            while (svg.firstChild) {
                svg.removeChild(svg.firstChild);
            }
            drawConnections();
            
            // Re-apply visibility to paths for animation if needed after redraw
            setTimeout(() => {
                const paths = document.querySelectorAll('.connection-path');
                paths.forEach(path => {
                    if (path.classList.contains('visible')) {
                        const pathLength = path.getTotalLength();
                        path.style.strokeDasharray = pathLength;
                        path.style.strokeDashoffset = 0;
                    }
                });
            }, 100);
        }

        // Function for 2D Matrix Rain Animation
        function animateMatrixRain() {
            matrixCtx.fillStyle = 'rgba(0, 0, 0, 0.04)';
            matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);

            matrixCtx.fillStyle = '#8A2BE2';
            matrixCtx.font = `${fontSize}px monospace`;
            matrixCtx.shadowBlur = 8;
            matrixCtx.shadowColor = '#8A2BE2';

            for (let i = 0; i < matrixDrops.length; i++) {
                const text = characters.charAt(Math.floor(Math.random() * characters.length));
                const x = i * fontSize;
                const y = matrixDrops[i] * fontSize;

                const brightness = Math.random() * 0.5 + 0.5;
                matrixCtx.fillStyle = `rgba(138, 43, 226, ${brightness})`;

                matrixCtx.fillText(text, x, y);

                if (matrixDrops[i] * fontSize > matrixCanvas.height && Math.random() > 0.009) {
                    matrixDrops[i] = 0;
                }

                matrixDrops[i] += 0.5;
            }

            matrixCtx.shadowBlur = 0;
        }

        // Main Animation Loop
        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            if (mixer) {
                mixer.update(delta);
            }

            // 2D Matrix Rain animation
            animateMatrixRain();

            // 3D Rendering
            renderer.render(scene, camera);
        }

        // Handle mouse movement for hover effect
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            if (model) {
                const intersects = raycaster.intersectObject(model, true);

                if (intersects.length > 0) {
                    if (!isHovering) {
                        isHovering = true;
                        document.body.style.cursor = 'pointer';
                        
                        if (model) {
                            model.traverse((child) => {
                                if (child.isMesh && child.material) {
                                    child.material.emissiveIntensity = 0.2;
                                }
                            });
                            model.scale.multiplyScalar(1.02);
                        }
                        
                        tooltip.classList.add('visible');
                    }
                    
                    tooltip.style.left = event.clientX + 'px';
                    tooltip.style.top = event.clientY + 'px';
                    
                } else {
                    if (isHovering) {
                        isHovering = false;
                        document.body.style.cursor = 'default';
                        
                        if (model) {
                            model.traverse((child) => {
                                if (child.isMesh && child.material) {
                                    child.material.emissive = new THREE.Color(0x000000);
                                    child.material.emissiveIntensity = 0;
                                }
                            });
                            model.scale.multiplyScalar(1/1.02);
                        }
                        
                        tooltip.classList.remove('visible');
                    }
                }
            }
        }

        // Handle mouse click on model
        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            if (model) {
                const intersects = raycaster.intersectObject(model, true);

                if (intersects.length > 0) {
                    window.location.href = 'robotic_projects.html';
                }
            }
        }

        // Touch events for mobile
        let touchTimeout;
        let modelTouched = false; // Flag to track if model was touched

        function onTouchStart(event) {
            if (event.touches.length === 1) {
                const touch = event.touches[0];
                mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);

                if (model) {
                    const intersects = raycaster.intersectObject(model, true);

                    if (intersects.length > 0) {
                        event.preventDefault(); // Prevent default touch behavior
                        
                        if (!modelTouched) {
                            // First touch - highlight the model
                            modelTouched = true;
                            isHovering = true;
                            
                            if (model) {
                                model.traverse((child) => {
                                    if (child.isMesh && child.material) {
                                        child.material.emissiveIntensity = 0.2;
                                    }
                                });
                                model.scale.multiplyScalar(1.02);
                            }
                            
                            tooltip.classList.add('visible');
                            tooltip.style.left = touch.clientX + 'px';
                            tooltip.style.top = touch.clientY + 'px';
                            
                        } else {
                            // Second touch - navigate to page
                            window.location.href = 'robotic_projects.html';
                        }
                    } else {
                        // Touched outside the model - reset everything
                        resetModelHighlight();
                    }
                }
            }
        }

        function onTouchEnd(event) {
            // Clear any pending navigation timeout
            if (touchTimeout) {
                clearTimeout(touchTimeout);
            }
        }

        // Helper function to reset model highlight
        function resetModelHighlight() {
            modelTouched = false;
            isHovering = false;
            
            if (model) {
                model.traverse((child) => {
                    if (child.isMesh && child.material) {
                        child.material.emissive = new THREE.Color(0x000000);
                        child.material.emissiveIntensity = 0;
                    }
                });
                model.scale.multiplyScalar(1/1.02);
            }
            
            tooltip.classList.remove('visible');
        }

        // Add a global touch listener to detect touches outside the model
        document.addEventListener('touchstart', function(event) {
            // This will be called for all touches on the document
            // The onTouchStart function will handle whether it's on the model or not
        }, { passive: false });

        // Countdown Timer
        function updateCountdown() {
            const graduationDate = new Date('2026-04-02T10:00:00');
            const now = new Date();
            const timeDiff = graduationDate - now;

            if (timeDiff > 0) {
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            } else {
                document.getElementById('graduation-countdown').innerHTML = '<span style="color: #8A2BE2; font-size: 1.2rem;">üéì Graduated! üéâ</span>';
            }
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Performance optimization for mobile
        function optimizeForMobile() {
            if (window.innerWidth <= 768) {
                // Reduce matrix rain density on mobile
                const mobileColumns = Math.floor(columns * 0.5);
                matrixDrops = matrixDrops.slice(0, mobileColumns);
                
                // Reduce 3D quality for better performance
                if (renderer) {
                    renderer.setPixelRatio(1);
                }
            }
        }

        // Debounce function for resize events
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Debounced resize handler
        const debouncedResize = debounce(onWindowResize, 250);
        window.addEventListener('resize', debouncedResize, false);

        // Initialize everything
        init();
        optimizeForMobile();

        // Update countdown every second
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Lazy load images if any
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                        imageObserver.unobserve(img);
                    }
                });
            });

            document.querySelectorAll('img.lazy').forEach(img => {
                imageObserver.observe(img);
            });
        }

        // Service Worker registration for offline support (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(() => {
                    // Service worker registration failed, app will still work online
                });
            });
        }

        // Page visibility API to pause animations when tab is not visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                clock.stop();
            } else {
                clock.start();
            }
        });

        // Console Easter egg
        console.log('%c Welcome to Andrea Veneroni\'s Portfolio! üöÄ', 'color: #8A2BE2; font-size: 20px; font-weight: bold;');
        console.log('%c Built with Three.js, love, and lots of coffee ‚òï', 'color: #666; font-size: 14px;');
    </script>
</body>
</html>