<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robotic Projects - Andrea Veneroni</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: #ffffff;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(136, 68, 255, 0.1);
            border-top: 3px solid #8844ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #8844ff;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(136, 68, 255, 0.6);
        }
        
        /* Full-screen 3D Canvas */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 1;
            touch-action: none;
        }
        
        /* Back button */
        .back-button {
            position: fixed;
            top: 30px;
            left: 30px;
            z-index: 100;
            background: rgba(136, 68, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(136, 68, 255, 0.3);
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            color: #8844ff;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 25px rgba(136, 68, 255, 0.2);
            text-shadow: 0 0 10px rgba(136, 68, 255, 0.6);
        }

        .back-button:hover {
            background: rgba(136, 68, 255, 0.2);
            border-color: rgba(136, 68, 255, 0.5);
            transform: translateX(-5px);
            box-shadow: 0 8px 35px rgba(136, 68, 255, 0.4);
            color: #b37aff;
        }
        
        /* Error */
        #error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff0000;
            font-size: 16px;
            text-align: center;
            max-width: 300px;
            display: none;
            z-index: 100;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
        }

        /* Common styles for all info panels */
        .info-panel-common {
            position: fixed;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(136, 68, 255, 0.4);
            border-radius: 15px;
            padding: 20px 30px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.4), inset 0 0 15px rgba(136, 68, 255, 0.1);
            color: #ffffff;
            text-shadow: 0 0 10px rgba(136, 68, 255, 0.4);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease-in-out;
        }

        .info-panel-common .icon {
            font-size: 2.5em;
            color: #8844ff;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(136, 68, 255, 0.8);
        }
        
        .info-panel-common h3, .info-panel-common h4 {
            font-size: 1.6rem;
            margin-bottom: 10px;
            color: #8844ff;
            text-shadow: 0 0 15px rgba(136, 68, 255, 0.6);
        }

        .info-panel-common p {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #ddd;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .info-panel-common:hover {
            border-color: rgba(136, 68, 255, 0.6);
            box-shadow: 0 8px 35px rgba(136, 68, 255, 0.4), inset 0 0 20px rgba(136, 68, 255, 0.2);
        }

        /* Project Description Panel (Top) */
        .project-description-panel {
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            max-width: 900px;
            animation: fadeInDown 1s ease forwards;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Floating Link Panels (Left/Right) */
        .floating-link-panel {
            top: 50%;
            transform: translateY(-50%);
            width: 280px;
            padding: 25px;
            animation: fadeIn 1s ease forwards;
        }
        
        .floating-link-panel.left-panel {
            left: 30px;
            animation-delay: 0.2s;
        }

        .floating-link-panel.right-panel {
            right: 30px;
            animation-delay: 0.4s;
        }
        
        .floating-link-panel.right-panel:hover, .floating-link-panel.left-panel:hover {
            transform: translateY(-50%) scale(1.03);
        }

        /* Spec list styling */
        .spec-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
            text-align: left;
            width: 100%;
        }
        
        .spec-list li {
            padding: 8px 0;
            color: #bbb;
            border-bottom: 1px solid rgba(136, 68, 255, 0.1);
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .spec-list li strong {
            color: #8844ff;
        }

        /* Button inside info panel */
        .panel-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            background: rgba(136, 68, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(136, 68, 255, 0.3);
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            color: #8844ff;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 15px rgba(136, 68, 255, 0.2);
            text-shadow: 0 0 8px rgba(136, 68, 255, 0.6);
            cursor: pointer;
            font-size: 0.9em;
        }

        .panel-button:hover {
            background: rgba(136, 68, 255, 0.2);
            border-color: rgba(136, 68, 255, 0.5);
            box-shadow: 0 5px 20px rgba(136, 68, 255, 0.4);
            color: #b37aff;
            transform: translateY(-2px);
        }

        /* Controls hint */
        .controls-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(136, 68, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(136, 68, 255, 0.2);
            padding: 15px 30px;
            border-radius: 50px;
            z-index: 10;
            text-align: center;
            opacity: 0;
            animation: fadeIn 1s ease 1s forwards;
            text-shadow: 0 0 10px rgba(136, 68, 255, 0.4);
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: rgba(136, 68, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(136, 68, 255, 0.4);
            border-radius: 50%;
            z-index: 90;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 25px rgba(136, 68, 255, 0.3);
        }

        .mobile-menu-toggle:active {
            transform: scale(0.95);
        }

        .mobile-menu-toggle i {
            font-size: 1.5rem;
            color: #8844ff;
            text-shadow: 0 0 10px rgba(136, 68, 255, 0.8);
        }

        /* Mobile Info Overlay */
        .mobile-info-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 95;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 80px 20px 30px;
            opacity: 0;
            transform: translateY(100%);
            transition: all 0.4s ease;
        }

        .mobile-info-overlay.active {
            opacity: 1;
            transform: translateY(0);
        }

        .mobile-info-overlay .close-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(136, 68, 255, 0.2);
            border: 1px solid rgba(136, 68, 255, 0.4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mobile-info-overlay .close-overlay i {
            color: #8844ff;
            font-size: 1.2rem;
        }

        .mobile-info-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .mobile-info-section {
            background: rgba(136, 68, 255, 0.05);
            border: 1px solid rgba(136, 68, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mobile-info-section .icon {
            font-size: 2.5rem;
            color: #8844ff;
            margin-bottom: 15px;
            display: block;
            text-shadow: 0 0 20px rgba(136, 68, 255, 0.8);
        }

        .mobile-info-section h3 {
            font-size: 1.5rem;
            color: #8844ff;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(136, 68, 255, 0.6);
        }

        .mobile-info-section p {
            font-size: 1rem;
            line-height: 1.6;
            color: #ddd;
            margin-bottom: 20px;
        }

        /* Touch gesture indicator */
        .touch-indicator {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 80;
            pointer-events: none;
            opacity: 0;
            animation: touchPulse 2s ease-in-out;
        }

        @keyframes touchPulse {
            0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
        }

        .touch-indicator .gesture-icon {
            width: 80px;
            height: 80px;
            background: rgba(136, 68, 255, 0.2);
            border: 2px solid rgba(136, 68, 255, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(136, 68, 255, 0.5);
        }

        .touch-indicator i {
            font-size: 2rem;
            color: #8844ff;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .project-description-panel {
                padding: 15px 20px;
            }
            .project-description-panel .icon {
                font-size: 2em;
            }
            .project-description-panel h3 {
                font-size: 1.4rem;
            }
            .project-description-panel p {
                font-size: 0.85rem;
            }

            .floating-link-panel {
                width: 250px;
                padding: 20px;
            }
            .floating-link-panel.left-panel {
                left: 15px;
            }
            .floating-link-panel.right-panel {
                right: 15px;
            }
            .floating-link-panel h4 {
                font-size: 1.3rem;
            }
            .floating-link-panel .icon {
                font-size: 2em;
            }
        }

        @media (max-width: 768px) {
            /* Hide desktop panels on mobile */
            .project-description-panel,
            .floating-link-panel,
            .controls-hint {
                display: none !important;
            }

            /* Show mobile menu toggle */
            .mobile-menu-toggle {
                display: flex;
            }

            /* Show touch indicator on mobile */
            .touch-indicator {
                display: block;
            }

            .back-button {
                top: 15px;
                left: 15px;
                padding: 10px 20px;
                font-size: 0.9rem;
                position: fixed;
                background: rgba(147, 112, 219, 0.2);
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
                z-index: 1000;
                box-shadow: 0 5px 25px rgba(147, 112, 219, 0.3), 
                            0 2px 10px rgba(0, 0, 0, 0.5);
            }

            /* Mobile-specific info overlay */
            .mobile-info-overlay {
                display: block;
            }

            /* Adjust canvas for mobile */
            #canvas-container {
                touch-action: pan-y pinch-zoom;
            }

            /* Mobile loading screen adjustments */
            .loading-spinner {
                width: 50px;
                height: 50px;
            }

            .loading-text {
                font-size: 1rem;
            }

            /* Mobile spec list */
            .mobile-info-section .spec-list {
                text-align: left;
                margin: 15px 0;
            }

            .mobile-info-section .spec-list li {
                padding: 6px 0;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .mobile-info-section {
                padding: 20px;
            }

            .mobile-info-section h3 {
                font-size: 1.3rem;
            }

            .mobile-info-section p {
                font-size: 0.9rem;
            }

            .panel-button {
                font-size: 0.85rem;
                padding: 8px 16px;
            }
        }

        /* Landscape mobile adjustments */
        @media (max-height: 600px) and (orientation: landscape) {
            .mobile-menu-toggle {
                bottom: 15px;
                right: 15px;
                width: 50px;
                height: 50px;
            }

            .back-button {
                top: 10px;
                left: 10px;
                padding: 8px 16px;
                font-size: 0.85rem;
            }

            .mobile-info-overlay {
                padding: 60px 20px 20px;
            }

            .mobile-info-section {
                padding: 15px;
                margin-bottom: 15px;
            }

            .mobile-info-section h3 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }

            .mobile-info-section p {
                font-size: 0.85rem;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading 3D Model...</div>
    </div>

    <!-- Back Button -->
    <a href="robotic_projects.html" class="back-button">
        <span>‚Üê</span> Back to Robotic Projects
    </a>
    
    <!-- 3D Canvas Container -->
    <div id="canvas-container"></div>
    
    <!-- Error Display -->
    <div id="error"></div>
    
    <!-- Desktop Info Panels -->
    <div class="project-description-panel info-panel-common">
        <h3>C. elegans</h3>
        <p>This project focuses on simulating the Caenorhabditis elegans (C. elegans) brain using neural networks. Our primary objective is to discover an efficient neural network with a novel structure capable of replicating the worm's 302 neurons and their precise synaptic connections. By observing emergent behaviors, this work seeks to advance our understanding of neural function and explore new paradigms for bio-inspired AI design.</p>
    </div>

    <div class="floating-link-panel left-panel info-panel-common">
        <span class="icon"><i class="fas fa-brain"></i></span>
        <h4>C. Elegans Nervous System Specs</h4>
        <ul class="spec-list">
            <li><strong>Neurons:</strong> <span>302</span></li>
            <li><strong>Synapses:</strong> <span>~7,000</span></li>
            <li><strong>Neuron Classes:</strong> <span>~100</span></li>
            <li><strong>Connectome:</strong> <span>Fully Mapped</span></li>
            <li><strong>Simplicity:</strong> <span>Simple Invertebrate</span></li>
            <li><strong>Abilities:</strong> <span>Learning, Memory</span></li>
        </ul>
    </div>

    <div class="floating-link-panel right-panel info-panel-common">
        <span class="icon"><i class="fas fa-flask"></i></span>
        <h4>Current Research Focus</h4>
        <p>My current research involves an in-depth study of the neural network's potential functionality and adaptability. I'm investigating how different network architectures can efficiently model C. elegans' neural processes and exploring methods for the network to adapt and learn, aiming to uncover generalized principles of biological intelligence and efficient AI design.</p>
    </div>
    
    <!-- Desktop Controls Hint -->
    <div class="controls-hint">
        üñ±Ô∏è Use mouse to rotate view ‚Ä¢ Scroll to zoom
    </div>

    <!-- Mobile Menu Toggle -->
    <div class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-info-circle"></i>
    </div>

    <!-- Mobile Info Overlay -->
    <div class="mobile-info-overlay" id="mobileInfoOverlay">
        <div class="close-overlay" id="closeOverlay">
            <i class="fas fa-times"></i>
        </div>
        <div class="mobile-info-content">
            <div class="mobile-info-section">
                <h3>C. elegans</h3>
                <p>This project focuses on simulating the Caenorhabditis elegans (C. elegans) brain using neural networks. Our primary objective is to discover an efficient neural network with a novel structure capable of replicating the worm's 302 neurons and their precise synaptic connections. By observing emergent behaviors, this work seeks to advance our understanding of neural function and explore new paradigms for bio-inspired AI design.</p>
            </div>

            <div class="mobile-info-section">
                <span class="icon"><i class="fas fa-brain"></i></span>
                <h4>C. Elegans Nervous System Specs</h4>
                <ul class="spec-list">
                    <li><strong>Neurons:</strong> <span>302</span></li>
                    <li><strong>Synapses:</strong> <span>~7,000</span></li>
                    <li><strong>Neuron Classes:</strong> <span>~100</span></li>
                    <li><strong>Connectome:</strong> <span>Fully Mapped</span></li>
                    <li><strong>Simplicity:</strong> <span>Simple Invertebrate</span></li>
                    <li><strong>Abilities:</strong> <span>Learning, Memory</span></li>
                </ul>
            </div>

            <div class="mobile-info-section">
                <span class="icon"><i class="fas fa-flask"></i></span>
                <h4>Current Research Focus</h4>
                <p>My current research involves an in-depth study of the neural network's potential functionality and adaptability. I'm investigating how different network architectures can efficiently model C. elegans' neural processes and exploring methods for the network to adapt and learn, aiming to uncover generalized principles of biological intelligence and efficient AI design.</p>
            </div>
        </div>
    </div>

    <!-- Touch Gesture Indicator -->
    <div class="touch-indicator" id="touchIndicator">
        <div class="gesture-icon">
            <i class="fas fa-hand-pointer"></i>
        </div>
    </div>

    <!-- Three.js Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.7.0/umd/index.min.js"></script>
    
    <script>
        // Global Three.js variables
        let scene, camera, renderer, controls;
        let dobot, floor;
        let mixer;
        let isAnimatingScale = false;
        let scaleAnimationProgress = 0;
        let targetScale = 1;
        const clock = new THREE.Clock();
        const container = document.getElementById('canvas-container');
        const errorElement = document.getElementById('error');
        const loadingScreen = document.getElementById('loadingScreen');

        // Mobile detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        // Model path
        const MODEL_PATH = 'worm.glb';

        // Mobile menu handling
        if (isMobile) {
            const menuToggle = document.getElementById('mobileMenuToggle');
            const infoOverlay = document.getElementById('mobileInfoOverlay');
            const closeOverlay = document.getElementById('closeOverlay');
            const backButton = document.querySelector('.back-button'); // Aggiungi questa riga

            menuToggle.addEventListener('click', () => {
                infoOverlay.classList.add('active');
                backButton.style.display = 'none'; // Nascondi il pulsante back
            });

            closeOverlay.addEventListener('click', () => {
                infoOverlay.classList.remove('active');
                backButton.style.display = 'flex'; // Mostra di nuovo il pulsante back
            });

            // Show touch indicator on first load
            setTimeout(() => {
                const touchIndicator = document.getElementById('touchIndicator');
                touchIndicator.style.opacity = '1';
                setTimeout(() => {
                    touchIndicator.style.opacity = '0';
                }, 3000);
            }, 2000);
        }

        // Initialization
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x000000, 10, 50);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(
                isMobile ? 50 : 45,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(5, 3, 5);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ 
                antialias: !isMobile,
                alpha: false,
                powerPreference: isMobile ? "low-power" : "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 2 : 3));
            renderer.shadowMap.enabled = !isMobile;
            if (!isMobile) {
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            }
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            container.appendChild(renderer.domElement);

            // Orbital controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = isMobile ? 0.25 : 0.05; // Aumentato per mobile
            controls.enableZoom = true; // Assicurati che sia abilitato
            controls.zoomSpeed = isMobile ? 1.0 : 1.2; // Velocit√† zoom appropriata
            controls.minDistance = 2;
            controls.maxDistance = 15;
            controls.maxPolarAngle = Math.PI / 2 - 0.1;
            controls.target.set(0, 2, 0);
            controls.enablePan = false;
            controls.enableZoom = true;
            controls.zoomSpeed = isMobile ? 1.0 : 1.2;

            if (isMobile) {
                controls.rotateSpeed = 0.5;
            }

            // Set mouse buttons for rotation and zoom
            controls.mouseButtons = {
                LEFT: THREE.MOUSE.ROTATE,
                MIDDLE: THREE.MOUSE.DOLLY,
                RIGHT: THREE.MOUSE.ROTATE
            };

            // Touch controls for mobile
            if (isTouch) {
                controls.touches = {
                    ONE: THREE.TOUCH.ROTATE,
                    TWO: THREE.TOUCH.DOLLY_PAN
                };
            }

            // Configure lights
            setupLights();

            // Create floor
            createFloor();

            // Load model
            loadDobotModel();

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);

            // Start animation
            animate();
        }

        // Configure lights
        function setupLights() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, isMobile ? 1.5 : 0.5);
            scene.add(ambientLight);

            // Main light
            const mainLight = new THREE.DirectionalLight(0xffffff, isMobile ? 1.5 : 1.2);
            mainLight.position.set(-5, 5, 0);
            if (!isMobile) {
                mainLight.castShadow = true;
                mainLight.shadow.mapSize.width = 2048;
                mainLight.shadow.mapSize.height = 2048;
                mainLight.shadow.camera.near = 0.5;
                mainLight.shadow.camera.far = 20;
                mainLight.shadow.camera.left = -5;
                mainLight.shadow.camera.right = 5;
                mainLight.shadow.camera.top = 5;
                mainLight.shadow.camera.bottom = -5;
                mainLight.shadow.bias = -0.001;
            }
            scene.add(mainLight);

            // Fill light
            const fillLight = new THREE.DirectionalLight(0xffffff, isMobile ? 1.3 : 0.5);
            fillLight.position.set(-3, 2, 3);
            scene.add(fillLight);

            // Spot light (desktop only)
            if (!isMobile) {
                const spotLight = new THREE.SpotLight(0xffffff, 3.5);
                spotLight.position.set(0, 8, 0);
                spotLight.angle = Math.PI / 6;
                spotLight.penumbra = 0.5;
                spotLight.decay = 2;
                spotLight.distance = 20;
                spotLight.castShadow = true;
                scene.add(spotLight);
            }
        }

        // Create floor
        function createFloor() {
            // Floor geometry
            const floorGeometry = new THREE.PlaneGeometry(isMobile ? 80 : 80, isMobile ? 80 : 80);
            
            // Dark concrete material
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x1a1a1a,
                roughness: 0.9,
                metalness: 0.1,
                normalScale: new THREE.Vector2(0.5, 0.5)
            });

            // Create floor mesh
            floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = !isMobile;
            scene.add(floor);

            // Add procedural texture for concrete
            const canvas = document.createElement('canvas');
            canvas.width = isMobile ? 256 : 512;
            canvas.height = isMobile ? 256 : 512;
            const context = canvas.getContext('2d');
            
            // Draw concrete texture
            context.fillStyle = '#1a1a1a';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add noise (less on mobile for performance)
            const noiseCount = isMobile ? 2000 : 5000;
            for (let i = 0; i < noiseCount; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const brightness = Math.random() * 30 + 10;
                context.fillStyle = `rgb(${brightness}, ${brightness}, ${brightness})`;
                context.fillRect(x, y, 1, 1);
            }
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.repeat.set(isMobile ? 2 : 4, isMobile ? 2 : 4);
            texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
            floorMaterial.map = texture;
            floorMaterial.needsUpdate = true;
        }

        // Load Dobot model
        function loadDobotModel() {
            const manager = new THREE.LoadingManager();

            manager.onLoad = () => {
                // Hide loading screen
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }, 500);
            };

            manager.onError = (url) => {
                console.error('Error loading:', url);
                errorElement.textContent = 'Error loading 3D model. Please check the file path.';
                errorElement.style.display = 'block';
                loadingScreen.classList.add('hidden');
            };

            const gltfLoader = new THREE.GLTFLoader(manager);

            gltfLoader.load(
                MODEL_PATH,
                function (gltf) {
                    dobot = gltf.scene;

                    // Center and scale the model
                    const box = new THREE.Box3().setFromObject(dobot);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    
                    const scale = 2 / Math.max(size.x, size.y, size.z);
                    targetScale = scale;
                    dobot.scale.setScalar(0);
                    
                    // Adjust position
                    dobot.position.x = 0;
                    dobot.position.y = -box.min.y * scale; 
                    dobot.position.z = 0;

                    dobot.rotation.z = THREE.MathUtils.degToRad(45); // Ruota di 30 gradi sull'asse X
                    
                    // Handle animations
                    if (gltf.animations && gltf.animations.length) {
                        mixer = new THREE.AnimationMixer(dobot);

                        gltf.animations.forEach((clip) => {
                            const action = mixer.clipAction(clip);
                            action.play();
                        });
                    }
                    
                    // Set shadows
                    dobot.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = !isMobile;
                            child.receiveShadow = !isMobile;
                            
                            // Optimize materials for mobile
                            if (isMobile && child.material) {
                                child.material.envMapIntensity = 0.5;
                                child.material.roughness = Math.min(child.material.roughness + 0.1, 1);
                            }
                        }
                    });
                    
                    scene.add(dobot);
                    
                    // Start scale animation
                    setTimeout(() => {
                        isAnimatingScale = true;
                    }, 500);
                },
                // Progress callback
                function (xhr) {
                    if (xhr.lengthComputable) {
                        const percentComplete = xhr.loaded / xhr.total * 100;
                        console.log('Loading: ' + Math.round(percentComplete) + '%');
                    }
                },
                // Error callback
                function (error) {
                    console.error('Error loading Dobot GLTF:', error);
                    errorElement.textContent = 'Error loading 3D model. Please try again.';
                    errorElement.style.display = 'block';
                    loadingScreen.classList.add('hidden');
                }
            );
        }

        // Update scale animation
        function updateScaleAnimation() {
            if (isAnimatingScale && scaleAnimationProgress < 1) {
                // Increase animation progress
                scaleAnimationProgress += isMobile ? 0.03 : 0.02;
                
                // Apply easing function
                const t = scaleAnimationProgress;
                const easedProgress = 1 - Math.pow(1 - t, 3);
                
                // Scale the model
                if (dobot) {
                    dobot.scale.setScalar(targetScale * easedProgress);
                }
                
                // Complete animation
                if (scaleAnimationProgress >= 1) {
                    isAnimatingScale = false;
                    if (dobot) {
                        dobot.scale.setScalar(targetScale);
                    }
                }
            }
        }

        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Touch gesture handling for mobile
        if (isTouch) {
            let touchStartTime = 0;
            let lastTouchEnd = 0;
            
            container.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
            }, { passive: true });
        }

        // Performance monitoring for mobile
        let lastTime = performance.now();
        let frameCount = 0;
        let fps = 60;

        function monitorPerformance() {
            if (!isMobile) return;
            
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime >= lastTime + 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                frameCount = 0;
                lastTime = currentTime;
                
                // Adjust quality based on performance
                if (fps < 30) {
                    renderer.setPixelRatio(1);
                    if (dobot) {
                        dobot.traverse((child) => {
                            if (child.isMesh && child.material) {
                                child.material.roughness = Math.min(child.material.roughness + 0.2, 1);
                            }
                        });
                    }
                }
            }
            
            requestAnimationFrame(monitorPerformance);
        }

        // Visibility change handling
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Pause animation when hidden
                if (mixer) mixer.timeScale = 0;
            } else {
                // Resume animation
                if (mixer) mixer.timeScale = 1;
            }
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Update scale animation
            updateScaleAnimation();
            
            // Update controls
            controls.update();
            
            // Update animation mixer
            if (mixer) {
                mixer.update(clock.getDelta());
            }
            
            // Rendering
            renderer.render(scene, camera);
        }

        // Start application
        init();
        
        // Start performance monitoring on mobile
        if (isMobile) {
            monitorPerformance();
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (renderer) {
                renderer.dispose();
            }
            if (scene) {
                scene.traverse((child) => {
                    if (child.geometry) {
                        child.geometry.dispose();
                    }
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            child.material.forEach(material => material.dispose());
                        } else {
                            child.material.dispose();
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>